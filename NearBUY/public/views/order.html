<!DOCTYPE html>
<html>
<head>

<!-- sets up angular -->
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
<!-- <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBsTAjge0lRGrWRkJvgDbH7s6-OFy7hnRo&libraries=places"></script> -->

<!-- This is the only thing that works to make it pretty -->
<!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css"> -->

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Mobirise v3.9.2, mobirise.com">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="assets/images/logo.png" type="image/x-icon">
  <meta name="description" content="">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic&amp;subset=latin">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i">
  <link rel="stylesheet" href="assets/bootstrap-material-design-font/css/material.css">
  <link rel="stylesheet" href="assets/tether/tether.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/animate.css/animate.min.css">
  <link rel="stylesheet" href="assets/dropdown/css/style.css">
  <link rel="stylesheet" href="assets/theme/css/style.css">
  <link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">
  
</head>
  <body>
<section id="ext_menu-i">

    <nav class="navbar navbar-dropdown navbar-fixed-top">
        <div class="container">

            <div class="mbr-table">
                <div class="mbr-table-cell">

                    <div class="navbar-brand">
                        <a href="localhost:8080" class="navbar-logo"><img src="assets/images/logo.png" alt="NearBUY"></a>
                        <a class="navbar-caption" href="localhost:8080">NearBUY<br></a>
                    </div>

                </div>
                <div class="mbr-table-cell">

                    <button class="navbar-toggler pull-xs-right hidden-md-up" type="button" data-toggle="collapse" data-target="#exCollapsingNavbar">
                        <div class="hamburger-icon"></div>
                    </button>

                    <ul class="nav-dropdown collapse pull-xs-right nav navbar-nav navbar-toggleable-sm" id="exCollapsingNavbar"><li class="nav-item"><a class="nav-link link" href="search.html" aria-expanded="true">Switch Roles</a></li><li class="nav-item"><a class="nav-link link" href="search.html" aria-expanded="true">Search for Products<br></a></li></ul>
                    <button hidden="" class="navbar-toggler navbar-close" type="button" data-toggle="collapse" data-target="#exCollapsingNavbar">
                        <div class="close-icon"></div>
                    </button>

                </div>
            </div>

        </div>
    </nav>

</section>
<section class="engine"><a rel="external" href="https://mobirise.com">best drag and drop web design software download</a></section><section class="mbr-section mbr-section-hero mbr-section-full mbr-after-navbar" id="header5-m" style="background-color: rgb(239, 239, 239);">

    

    <div class="mbr-table-cell">

        <div class="container">
            <div class="row">
                <div class="mbr-section col-md-10">

                    <h1 class="mbr-section-title display-1">Order</h1>
                    <p class="mbr-section-lead lead">Full screen intro with color background.<br>Buttons, text and title are aligned to the left.</p>
                   
                </div>
            </div>
        </div>
    </div>
</section>  
    
<body>
<!-- fixes the nav bar from blocking the view -->
<div id="fix-for-navbar-fixed-top-spacing" style="height: 42px;">&nbsp;</div>


<!-- make a navigation bar -->
<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <a class="navbar-brand" href="../index.html">NearBuy</a>
    </div>
  </div>
</nav>
<p></p>
<div ng-app="OrderCtrl" ng-controller="OrderController">
  <div class="jumbotron">
    <div class="container">


      <!-- Search instructions -->
      <h1>Order form: </h1><h1 id="here"></h1>
      <p> 
        To order from this place enter in the list below.
      </p>
    </div>
  </div>

  <h3> Shopping list </h3>
  <p>Please enter in a shopping list below</p>

<div>
    <input type="text" ng-model="newItem" placeholder="Enter in an item" required />
    <p><button ng-click="addItem()" class="btn btn-primary">Add</button></p>

  <ul>
    <li ng-repeat="item in list">
      <span>{{ item.name }}</span>
      <button type="button" class="btn btn-xs btn-danger" ng-click="deleteItem($index)">Remove</button>
      <!-- <span class="fa fa-close" ng-click="deleteItem($index)"></span> -->
    </li>
  </ul>

  <p>Enter in any additional notes about the items below
  <form>
  <textarea name="myTextBox" cols="50" rows="5" ng-model="notes">
  Enter additional info...
  </textarea>
  <br />
  </form>


  <h3> Enter in a price </h3>
  <p>Please enter a price you are willing to pay for all these items</p>

  <div class="input-group">
    <span class="input-group-addon">$</span>
    <input class="form-control" id="price" aria-label="Amount (to the nearest dollar)" ng-model="price" required>
    <span class="input-group-addon">.00</span>
    <span class="input-group-btn">
        <button class="btn btn-default" type="button" ng-click="updateTotal()">Update</button>
    </span>
  </div>

  <h3>Order Review</h3>
  <table class="table table-bordered">
    <thead>
    <tr>
      <th>Item</th>
    </tr>
    </thead>

    <tbody>
      <tr ng-repeat="item in list">
        <td>{{ item.name }}</td>
      </tr>
      <tr>
        <td><strong>Total Cost: ${{ total }}</strong></td>
    </tbody>

  </table>

  <h3>Payment and Delivery</h3>
  <p>Please enter payment and delivery details below.</p>

  <!-- this for the square payment form -->
  <script type="text/javascript" src="https://js.squareup.com/v2/paymentform"></script>

  <!--
    These styles can live in a separate .css file. They're just here to keep this
    example to a single file.
  -->
  <style type="text/css">
    .sq-input {
      border: 1px solid rgb(223, 223, 223);
      outline-offset: -2px;
      margin-bottom: 5px;
    }
    .sq-input--focus {
      /* Indicates how form inputs should appear when they have focus */
      outline: 5px auto rgb(59, 153, 252);
    }
    .sq-input--error {
      /* Indicates how form inputs should appear when they contain invalid values */
      outline: 5px auto rgb(255, 97, 97);
    }
  </style>

<body>

<form id="payment-form" onsubmit="return paymentFormSubmit()"> 

  <label>Email</label>
  <input type="email" id="email" name="email"  ng-model="email" placeholder="Email" required/>

  <h4>Delivery Address</h4>

  <label>Street</label>
  <input type="text" id="street_address_1" name="street_address_1" ng-model="address_1" placeholder="Address Line 1"required/>

  <label>Street</label>
  <input type="text" id="street_address_2" name="street_address_2" ng-model="address_2" placeholder="Address Line 2"/>

  <label>City</label>
  <input type="text" id="city" name="city"  ng-model="city" placeholder="City" required/>

  <label>State</label>
  <select id="state" name="state" ng-model="state" required>
  <option value="AL">Alabama</option>
  <option value="AK">Alaska</option>
  <option value="AZ">Arizona</option>
  <option value="AR">Arkansas</option>
  <option value="CA">California</option>
  <option value="CO">Colorado</option>
  <option value="CT">Connecticut</option>
  <option value="DE">Delaware</option>
  <option value="DC">District of Columbia</option>
  <option value="FL">Florida</option>
  <option value="GA">Georgia</option>
  <option value="HI">Hawaii</option>
  <option value="ID">Idaho</option>
  <option value="IL">Illinois</option>
  <option value="IN">Indiana</option>
  <option value="IA">Iowa</option>
  <option value="KS">Kansas</option>
  <option value="KY">Kentucky</option>
  <option value="LA">Louisiana</option>
  <option value="ME">Maine</option>
  <option value="MD">Maryland</option>
  <option value="MA">Massachusetts</option>
  <option value="MI">Michigan</option>
  <option value="MN">Minnesota</option>
  <option value="MS">Mississippi</option>
  <option value="MO">Missouri</option>
  <option value="MT">Montana</option>
  <option value="NE">Nebraska</option>
  <option value="NV">Nevada</option>
  <option value="NH">New Hampshire</option>
  <option value="NJ">New Jersey</option>
  <option value="NM">New Mexico</option>
  <option value="NY">New York</option>
  <option value="NC">North Carolina</option>
  <option value="ND">North Dakota</option>
  <option value="OH">Ohio</option>
  <option value="OK">Oklahoma</option>
  <option value="OR">Oregon</option>
  <option value="PA">Pennsylvania</option>
  <option value="RI">Rhode Island</option>
  <option value="SC">South Carolina</option>
  <option value="SD">South Dakota</option>
  <option value="TN">Tennessee</option>
  <option value="TX">Texas</option>
  <option value="UT">Utah</option>
  <option value="VT">Vermont</option>
  <option value="VA">Virginia</option>
  <option value="WA">Washington</option>
  <option value="WV">West Virginia</option>
  <option value="WI">Wisconsin</option>
  <option value="WY">Wyoming</option>
  </select>

  <label>Zip</label>
  <input type="text" id="zip" name="zip" ng-model="zip" placeholder="Zip"/>

  <div id="card-errors">

  </div>

  <h4>Card Information</h3>
  <!--
    These div elements are the placeholder elements that are replaced by the
    SqPaymentForm's iframes.
  -->
  <div>
  <label>Card Number</label>
  <div id="sq-card-number"></div>
  </div>

  <div>
  <label>CVV</label>
  <div id="sq-cvv"></div>
  </div>

  <div>
  <label>Expiration Date</label>
  <div id="sq-expiration-date"></div>
  </div>

  <div>
  <label>Postal Code</label>
  <div id="sq-postal-code"></div>
  </div>

  <div>
  <input type="submit" id="submit" value="Buy Now" class="btn btn-primary" ng-click="addRequest()" onClick="window.location='tracking.html'">
  </div>

  </form>
  </div>
 <script>

    var applicationId = 'sandbox-sq0idp-0ibNUDIACVVf8P4I1orp9g'; // <-- Add your application's ID here
    var cardNonce;
    var paymentForm = new SqPaymentForm({
      applicationId: applicationId,
      inputClass: 'sq-input',
      inputStyles: [
          {
            fontSize: '14px',
            padding: '7px 12px',
            backgroundColor: "transparent"
          }
        ],
      cardNumber: {
        elementId: 'sq-card-number',
        placeholder: '0000 0000 0000 0000'    
      },
      cvv: {
        elementId: 'sq-cvv',
        placeholder: 'CVV'
      },
      expirationDate: {
        elementId: 'sq-expiration-date',
        placeholder: 'MM/YY'
      },
      postalCode: {
        elementId: 'sq-postal-code',
        placeholder: '94110'
      },
      callbacks: {
        cardNonceResponseReceived: function(errors, nonce, cardData) {
          if (errors){
            var error_html = ""
            for (var i =0; i < errors.length; i++){
              error_html += "<li> " + errors[i].message + " </li>";
            }
            document.getElementById("card-errors").innerHTML = error_html;
            document.getElementById('submit').disabled = false;
          }else{
            document.getElementById("card-errors").innerHTML = "";
            chargeCardWithNonce(nonce);
          }
          
          
        },
        unsupportedBrowserDetected: function() {
          // Alert the buyer
        }
      }
    });

    // build payment form after DOM load
    document.addEventListener('page:change', function(){
      console.log('dom loaded')
      paymentForm.build()
    });

    var paymentFormSubmit = function(){
      console.log('submit clicked');
      document.getElementById('submit').disabled = true;
      paymentForm.requestCardNonce();
      return false;
    }

    var chargeCardWithNonce = function(nonce) {
      // var name = document.getElementById('name').value;
      var email = document.getElementById('email').value;
      // var street_address_1 = document.getElementById('street_address_1').value;
      // var street_address_2 = document.getElementById('street_address_2').value;
      // var city = document.getElementById('city').value;
      // var state = document.getElementById('state').value;
      // var zip = document.getElementById('zip').value;
      var price = document.getElementById('price').value;
      
      var http = new XMLHttpRequest();
      var url = "/api/payment";
      var params = "transaction_id=" + 11111 //change this to an encyrption of a user id
      +"&user_email=" + email 
      + "&nonce=" + nonce
      + "&price=" + price;

      http.open("POST", url, true);

      //Send the proper header information along with the request
      http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      http.setRequestHeader("X-CSRF-Token", "<%= form_authenticity_token %>");

      http.onreadystatechange = function() {//Call a function when the state changes.
          if(http.readyState == 4 && http.status == 200) {
            var data = JSON.parse(http.responseText)
            if (data.status == 200) {
              // document.getElementById("successNotification").style.display = "block";
              // document.getElementById("payment-form").style.display = "none";
              // window.scrollTo(0, 0);
              console.log('success');
              console.log(data);
            }else if (data.status == 400){
              var error_html = ""
              for (var i =0; i < data.errors.length; i++){
                error_html += "<li> " + data.errors[i].detail + " </li>";
              }
              // document.getElementById("card-errors").innerHTML = error_html;
              // document.getElementById('submit').disabled = false;
              console.log('failure');
            }
          }
      }
      http.send(params);
    }

</script>

<script type="text/javascript" src="../js/app.js"></script>
<script type="text/javascript" src="../js/appRoutes.js"></script>
<script type="text/javascript" src="../js/app.js"></script>
<script type="text/javascript" src="../js/controllers/OrderCtrl.js"></script>

<footer class="mbr-small-footer mbr-section mbr-section-nopadding" id="footer1-j" style="background-color: rgb(50, 50, 50); padding-top: 1.75rem; padding-bottom: 1.75rem;">
    
    <div class="container">
        <p class="text-xs-center">Copyright (c) 2016 NearBUY<br><br></p>
    </div>
</footer>


  <script src="assets/web/assets/jquery/jquery.min.js"></script>
  <script src="assets/tether/tether.min.js"></script>
  <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  <script src="assets/smooth-scroll/SmoothScroll.js"></script>
  <script src="assets/viewportChecker/jquery.viewportchecker.js"></script>
  <script src="assets/dropdown/js/script.min.js"></script>
  <script src="assets/touchSwipe/jquery.touchSwipe.min.js"></script>
  <script src="assets/theme/js/script.js"></script>
  
  
  <input name="animation" type="hidden">
  </body>
</html>
